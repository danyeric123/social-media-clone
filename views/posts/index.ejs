<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<main>
  <% if(user){ %> 
    <div class="card justify-content-center align-self-center" style="width: 40rem;">
      <h2 class="card-header">Write a Post</h2>
      <form action="/posts" method="POST">
    
        <div class="mb-3 mx-5">
          <label for="post-content" class="form-label">Post</label>
          <textarea class="form-control" name="text" id="post-content" rows="5"></textarea>
        </div>
        <div class="mb-3 mx-5">
          <label for="title-input" class="form-label">Categories</label>
          <input 
            type="text" 
            class="form-control" 
            id="title-input"
            name="categories" 
            placeholder="Choose a category"
          >
        </div>
        <button class="btn btn-primary ms-5" type="submit">Post</button>
        </form>
    </div>
    <% } %> 
    <section>
    <div class="container py-5 px-3">
      <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g5 px-sm-5 px-4">
    <% posts.forEach((post, idx) => { %>
      
        <div class="col">
        <div 
        class="card text-center bg-light mb-3"
        >
          <div class="card-header">
            <a 
              href="/profiles/<%= post.author._id %>"
              class="text-decoration-none"
            >
              <%= post.author.name %>
              <img
                src="<%= post.author.avatar %>"
                class="img-fluid rounded-circle"
                alt="<%= post.author.name %>'s avatar"
                height="35"
                width="35"
              />
           </a>
          </div>
          <a 
            href="/posts/<%= post._id %>" 
            class="card-text text-decoration-none"
          >
            <p class=""><%= post.text %></p>
          </a>
          <p class="text-muted">
            on <%= post.createdAt.toLocaleDateString() %>
          </p>
          <%# Put something here for categories %> 
          <p>
            <span class="text-muted">Categories: </span>
              <% post.categories.forEach((category,index) => { %>
                <% if(index>0) {%> 
                  ,
                  <% } %> 
                <a 
                  href="#"
                  class=""
                >
                <%= category %> 
              </a>
              <% }); %>
          </p>
          <% if (!profile._id.equals(userProfile._id) && !userProfile.friends.includes(profile._id)) { %>
          <form 
            action="/posts/<%= post._id %>?_method=DELETE"
            class="delete-form align"
            method="POST"
          >
            <button class="btn btn-outline-danger" type="submit">X</button>
           </form>

          <%# Put something here to check if logged in and if so, add reply %> 


        </div>
        </div>

      
    <% }) %>
    </div>
  </section>
  </main>
  <%- include('../partials/footer') %>
  